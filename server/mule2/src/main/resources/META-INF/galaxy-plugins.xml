<?xml version="1.0" encoding="UTF-8"?>
<galaxy-plugins xmlns="http://www.mulesource.org/schema/galaxy-plugin"
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
       xsi:schemaLocation="http://www.mulesource.org/schema/galaxy-plugin http://www.mulesource.org/schema/galaxy-plugin/galaxy-plugin-1.0.xsd">

    <galaxy-plugin>
        <name>Mule 2 Configurations</name>
        <description>Allows Mule 2 cofiguration files to be managed by Galaxy. Users can register, query and view Mule 2
            configuration files with this plugin.
        </description>
        <content-type>application/mule2+xml</content-type>
        <!--<small-icon>META-INF/images/mule2_16x16.png</small-icon>-->
        <!--<large-icon>META-INF/images/mule2_32x32.png</large-icon>-->
        <namespace>
            <local-name>mule</local-name>
            <uri>http://www.mulesource.org/schema/mule/core/2.0</uri>
        </namespace>
        <indexes>
            <index>
                <field-name>mule2.description</field-name>
                <display-name>Mule 2 Description</display-name>
                <description>The description for the Mule configuration</description>
                <language>XPATH</language>
                <search-input-type>java.lang.String</search-input-type>
                <expression><![CDATA[/*[local-name()='${namespace.local-name}' and namespace-uri()='${namespace.uri}']/*[local-name()='description']
                ]]></expression>
            </index>
            <!--<index>-->
                <!--<field-name>mule2.model.description</field-name>-->
                <!--<display-name>Mule 2 Model Description</display-name>-->
                <!--<description>The description for a Mule Model in the configuration</description>-->
                <!--<language>XPATH</language>-->
                <!--<search-input-type>java.lang.String</search-input-type>-->
                <!--<expression><![CDATA[/*[local-name()='${namespace.local-name}' and namespace-uri()='${namespace.uri}']/*[local-name()='model/description']-->
                <!--]]></expression>-->
            <!--</index>-->
            <!--<index>-->
                <!--<field-name>mule2.service.description</field-name>-->
                <!--<display-name>Mule 2 Service Description</display-name>-->
                <!--<description>The description for a Mule Service in the configuration</description>-->
                <!--<language>XPATH</language>-->
                <!--<search-input-type>java.lang.String</search-input-type>-->
                <!--<expression><![CDATA[/*[local-name()='${namespace.local-name}' and namespace-uri()='${namespace.uri}']//*[local-name()='service']-->
                <!--]]></expression>-->
            <!--</index>-->
            <index>
                <field-name>mule2.server.id</field-name>
                <display-name>Mule 2 Server Id</display-name>
                <description>Indexes the Mule node serverId</description>
                <language>XPATH</language>
                <search-input-type>java.lang.String</search-input-type>
                <expression><![CDATA[/*/*[local-name()='configuration']/@serverId]]></expression>
            </index>
            <index>
                <field-name>mule2.cluster.id</field-name>
                <display-name>Mule 2 Cluster Id</display-name>
                <description>Indexes the Mule node clusterId</description>
                <language>XPATH</language>
                <search-input-type>java.lang.String</search-input-type>
                <expression><![CDATA[/*/*[local-name()='configuration']/@clusterId]]>
                </expression>
            </index>
            <index>
                <field-name>mule2.domain.id</field-name>
                <display-name>Mule 2 Domain Id</display-name>
                <description>Indexes the Mule node domainId</description>
                <language>XPATH</language>
                <search-input-type>java.lang.String</search-input-type>
                <expression><![CDATA[/*/*[local-name()='configuration']/@domainId]]>
                </expression>
            </index>
            <index>
                <field-name>mule2.service</field-name>
                <display-name>Mule 2 Services</display-name>
                <description>Indexes Mule 2 Service elements</description>
                <language>XQUERY</language>
                <search-input-type>java.lang.String</search-input-type>
                <expression><![CDATA[
declare default element namespace "${namespace.uri}";
declare variable $document external;
<values> {
    for $svc in $document//service
        return <value>{data($svc/@name)}</value>
} </values>
]]>
                </expression>
            </index>
            <index>
                <field-name>mule2.endpoint</field-name>
                <display-name>Mule 2 Global Endpoints</display-name>
                <description>Indexes Mule 2 Global (Top Level) endpoints</description>
                <language>XQUERY</language>
                <search-input-type>java.lang.String</search-input-type>
                <expression><![CDATA[
declare default element namespace "${namespace.uri}";
declare variable $document external;
<values> {
    for $svc in $document/mule/endpoint
        return <value>{data($svc/@name)}</value>
} </values>
]]>
                </expression>
            </index>
            <index>
                <field-name>mule2.model</field-name>
                <display-name>Mule 2 Models</display-name>
                <description>Indexes Mule 2 service models</description>
                <language>XQUERY</language>
                <search-input-type>java.lang.String</search-input-type>
                <expression><![CDATA[
declare default element namespace "${namespace.uri}";
declare variable $document external;
<values> {
    for $svc in $document/mule/model
        return <value>{data($svc/@name)}</value>
} </values>
]]>
                </expression>
            </index>
        </indexes>
        <views>
            <view>
                <column>
                    <name>Services</name>
                    <expression>artifact.hasProperty("mule2.service") ? artifact.getProperty("mule2.service").size() : "0" ;</expression>
                </column>
                <column>
                    <name>Endpoints</name>
                    <expression>artifact.hasProperty("mule2.endpoint") ? artifact.getProperty("mule2.endpoint").size() : "0" ;</expression>
                </column>
                <column>
                    <name>Models</name>
                    <expression>artifact.hasProperty("mule.model2") ? artifact.getProperty("mule2.model").size() : "0" ;</expression>
                </column>
            </view>
        </views>
    </galaxy-plugin>
 </galaxy-plugins>